<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>图片上传</title>
</head>
<body>
    <input type="file" accept="image/*" multiple />
    <img class="preview" />
    <script type="text/javascript">
        function fixImageOrientation (file) {
            return new Promise((resolve, reject) => {
                // 获取图片
                const img = new Image();
                img.src = window.URL.createObjectURL(file);
                img.onerror = () => resolve(file);
                img.onload = () => {
                    // 获取图片元数据（EXIF为exif-js暴露的全局变量）
                    EXIF.getData(img, function() {
                        // 获取图片旋转标志位
                        var orientation = EXIF.getTag(this, 'Orientation');
                        // 根据旋转角度，在画布上对图片旋转
                        if (orientation === 3 || orientation === 6 || orientation === 8) {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            switch (orientation) {
                                case 3: // 旋转180°
                                    canvas.width = img.width;
                                    canvas.height = img.height;
                                    ctx.rotate((180 * Math.PI) / 180);
                                    ctx.drawImage(img, -img.width, -img.height, img.width, img.height);
                                    break;
                            }
                        }
                    });
                }
            });
        }
        function onFileChange (e) {
            const files = Array.prototype.slice.call(event.target.files);
            files.forEach(file => {
                console.log('file name:', file.name);
            });
            const file = files[0];
            document.querySelector('img').src = window.URL.createObjectURL(file);
        }
        document.querySelector('input').addEventListener('change', onFileChange);
    </script>
    <script type="text/javascript" src="http://files.bughub.top/js/exif.js"></script>
</body>
</html>